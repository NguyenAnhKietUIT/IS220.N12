
@{
    Layout = null;
    var account = Session["Account"] as IS220.N12.Models.ACCOUNT;
    string[] search = (string[])Session["Search"];
    var searchPlace = Session["SearchPlace"] as string;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="~/Content/custom/base.css" />
    <link rel="stylesheet" href="~/Content/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/Assets/font-awesome/css/all.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <link rel="stylesheet" href="~/Content/custom/Search.css" />
    <title>Search</title>
    <style>
        input[type="range"] {
            position: absolute;
            height: 0;
            width: 0;
            opacity: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .app__main-content {
            width: 1224px;
        }

        .app__search-btn:hover {
            background-color: #565656;
        }

        .result-item-info-price span {
            line-height: 32px;
        }
    </style>
</head>
<body>
    <header class="app__header">
        <nav class="app__nav" style="max-width: 1200px;margin: 0 auto;">
            <a href="Index" class="app__nav-name-link">
                <img src="../assets/img/logo.png" alt="Logo" class="app__nav-name-icon">
            </a>

            <ul class="app__nav-list">
                <li class="app__nav-item">
                    <a href="Index" class="app__nav-item-link">Home</a>
                </li>
                <li class="app__nav-item">
                    <a href="Contact" class="app__nav-item-link">Contacts</a>
                </li>
                <li class="app__nav-item">
                    @if (account != null)
                    {
                        <a href="~/CUSTOMER/YourAccount" class="app__nav-item-link">@account.Username</a>
                    }
                    else
                    {
                        <a href="~/ACCOUNT/SignUpCustomer" class="app__nav-item-link">Sign Up</a>
                    }
                </li>
            </ul>
        </nav>
    </header>

    <div style="max-width: 1200px;margin: 0 auto;">
        @if (search != null)
        {
            <div class="d-flex justify-content-around align-items-center"
                 style="height: 60px;
                    margin-top: 64px;
                    border-radius: 12px;
                    box-shadow: 0 0 2px 2px rgb(0 0 0 / 5%);">
                <div class="py-1 d-flex align-items-center">
                    <i class="pe-2 fa-solid fa-magnifying-glass"></i>
                    <input type="text" name="search-destination"
                           placeholder="SESSION"
                           value="@search[0]"
                           style="width: 320px;">
                </div>
                <div class="py-1 position-relative" style="width: 140px;">
                    <div class="d-flex align-items-center">
                        <i class="pe-2 fa-solid fa-plane-departure"></i>
                        <div class="app__status-in d-none">Check in</div>
                        <input type="date" name="check-in-date" id="app__check-in" class="d-block"
                               min="@search[1]" max="2050-12-31" value="@search[1]">
                    </div>
                    <p class="position-absolute toast-message-in p-1 text-center">
                        The maximum interval between two
                        days is thirty
                    </p>
                </div>
                <div class="py-1 position-relative" style="width: 140px;">
                    <div class="d-flex align-items-center">
                        <i class="pe-2 fa-solid fa-money-check"></i>
                        <div class="app__status-out d-none">Check out</div>
                        <input type="date" name="check-out-date" id="app__check-out" class="d-block"
                               min="@search[1]" max="2050-12-31" value="@search[2]">
                    </div>
                    <p class="position-absolute toast-message-out p-1 text-center">
                        The maximum interval between two
                        days is thirty
                    </p>
                </div>
                <div class="d-flex py-1 position-relative">
                    <div class="d-flex align-items-center">
                        <i class="pe-2 fa-solid fa-people-group"></i>
                        <div class="app__search-quantity">
                            <span>@search[3]</span>
                            bed,
                            <span>@search[4]</span>
                            adults
                        </div>
                    </div>

                    <div class="box-quantity">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <input type="range" name="bed-num" id="bed-num" min="1" max="30" step="1" value="@search[3]">
                            <div class="">
                                <label for="bed-num">Beds</label>
                            </div>
                            <div class="d-flex justify-content-between align-items-center" style="width: 110px;">
                                <button type="button" class="btn-minus-bed">-</button>
                                <span class="amount-bed">@search[3]</span>
                                <button type="button" class="btn-add-bed">+</button>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <input type="range" name="per-num" id="per-num" min="1" step="1" value="@search[4]">
                            <div class="">
                                <label for="per-num">Adults</label>
                            </div>
                            <div class="d-flex justify-content-between align-items-center" style="width: 110px;">
                                <button type="button" class="btn-minus-people">-</button>
                                <span class="amount-people">@search[4]</span>
                                <button type="button" class="btn-add-people">+</button>
                            </div>
                        </div>
                        <button type="button" class="btn-accept">Accept</button>
                    </div>
                </div>
                <div class="d-flex py-1">
                    <button type="button" class="app__search-btn">Search</button>
                </div>
            </div>
        }
        else
        {
            <div class="d-flex justify-content-around align-items-center"
                 style="height: 60px;
                    margin-top: 64px;
                    border-radius: 12px;
                    box-shadow: 0 0 2px 2px rgb(0 0 0 / 5%);">
                @if (searchPlace != null)
                {
                    <div class="py-1 d-flex align-items-center">
                        <i class="pe-2 fa-solid fa-magnifying-glass"></i>
                        <input type="text" name="search-destination"
                               placeholder="Search destinations, hotels"
                               value="@searchPlace"
                               style="width: 320px;">
                    </div>
                }
                else
                {
                    <div class="py-1 d-flex align-items-center">
                        <i class="pe-2 fa-solid fa-magnifying-glass"></i>
                        <input type="text" name="search-destination"
                               placeholder="Search destinations, hotels"
                               style="width: 320px;">
                    </div>
                }
                <div class="py-1 position-relative" style="width: 140px;">
                    <div class="d-flex align-items-center">
                        <i class="pe-2 fa-solid fa-plane-departure"></i>
                        <div class="app__status-in">Check in</div>
                        <input type="date" name="check-in-date" id="app__check-in"
                               min="2017-10-14" max="2050-12-31">
                    </div>
                    <p class="position-absolute toast-message-in p-1 text-center">
                        The maximum interval between two
                        days is thirty
                    </p>
                </div>
                <div class="py-1 position-relative" style="width: 140px;">
                    <div class="d-flex align-items-center">
                        <i class="pe-2 fa-solid fa-money-check"></i>
                        <div class="app__status-out">Check out</div>
                        <input type="date" name="check-out-date" id="app__check-out"
                               min="2017-10-14" max="2050-12-31">
                    </div>
                    <p class="position-absolute toast-message-out p-1 text-center">
                        The maximum interval between two
                        days is thirty
                    </p>
                </div>
                <div class="d-flex py-1 position-relative">
                    <div class="d-flex align-items-center">
                        <i class="pe-2 fa-solid fa-people-group"></i>
                        <div class="app__search-quantity">
                            <span>1</span>
                            bed,
                            <span>2</span>
                            adults
                        </div>
                    </div>

                    <div class="box-quantity">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <input type="range" name="bed-num" id="bed-num" min="1" max="30" step="1" value="1">
                            <div class="">
                                <label for="bed-num">Beds</label>
                            </div>
                            <div class="d-flex justify-content-between align-items-center" style="width: 110px;">
                                <button type="button" class="btn-minus-bed">-</button>
                                <span class="amount-bed">1</span>
                                <button type="button" class="btn-add-bed">+</button>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <input type="range" name="per-num" id="per-num" min="1" step="1" value="2">
                            <div class="">
                                <label for="per-num">Adults</label>
                            </div>
                            <div class="d-flex justify-content-between align-items-center" style="width: 110px;">
                                <button type="button" class="btn-minus-people">-</button>
                                <span class="amount-people">2</span>
                                <button type="button" class="btn-add-people">+</button>
                            </div>
                        </div>
                        <button type="button" class="btn-accept">Accept</button>
                    </div>
                </div>
                <div class="d-flex py-1">
                    <button type="button" class="app__search-btn">Search</button>
                </div>
            </div>
        }

        <div class="app__sort">
            <button class="btn-sort">
                <span>Sort by</span>
                <div class="box-sort">
                    <ul class="box-sort-list">
                        <li class="box-sort-list-item">Price &uarr;</li>
                        <li class="box-sort-list-item">Price &darr;</li>
                        <li class="box-sort-list-item">Nearest</li>
                    </ul>
                </div>
            </button>
        </div>

        <div class="app__main-content row">
            <div class="col-4">
                <div class="map">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d502056.6239383943!2d105.2842887631872!3d10.554318626027014!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x310a65b3d50c121f%3A0xdca0c95ead346e40!2zxJDhu5NuZyBUaMOhcCwgVmnhu4d0IE5hbQ!5e0!3m2!1svi!2s!4v1670054231946!5m2!1svi!2s"
                            width="400" height="300" style="border:0;" allowfullscreen="" loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>

                <div div class="filter">
                    <div class="filter-box">
                        <span class="filter__header">Max price</span>
                        <div class="filter__main-box">
                            <input type="radio" name="filter__main-radio" id="filter__main-2500000" value="2500000">
                            <label for="filter__main-2500000">2500000</label>
                        </div>
                        <div class="filter__main-box">
                            <input type="radio" name="filter__main-radio" id="filter__main-4000000" value="4000000">
                            <label for="filter__main-4000000">4000000</label>
                        </div>
                        <div class="filter__main-box">
                            <input type="radio" name="filter__main-radio" id="filter__main-5000000" value="5000000">
                            <label for="filter__main-5000000">5000000</label>
                        </div>
                        <div class="filter__main-box">
                            <input type="radio" name="filter__main-radio" id="filter__main-6000000" value="6000000">
                            <label for="filter__main-6000000">6000000</label>
                        </div>
                    </div>

                    <div class="filter-box">
                        <span class="filter__header">Property type</span>
                        <div class="filter__main-box">
                            <input type="checkbox" name="filter__main-apartment" id="filter__main-apartment">
                            <label for="filter__main-apartment">Apartment</label>
                        </div>
                        <div class="filter__main-box">
                            <input type="checkbox" name="filter__main-hotel" id="filter__main-hotel">
                            <label for="filter__main-hotel">Hotel</label>
                        </div>
                        <div class="filter__main-box">
                            <input type="checkbox" name="filter__main-resort" id="filter__main-resort">
                            <label for="filter__main-resort">Resort</label>
                        </div>
                        <p class="action-see-active">See more</p>
                        <div class="filter-see-more">
                            <div class="filter__main-box">
                                <input type="checkbox" name="filter__main-homestay" id="filter__main-homestay">
                                <label for="filter__main-homestay">Homestay</label>
                            </div>
                        </div>
                        <p class="action-see-unactive">Hide</p>
                    </div>

                    <div class="filter-box">
                        <span class="filter__header">Room type</span>
                        <div class="filter__main-box">
                            <input type="checkbox" name="filter__main-standard" id="filter__main-standard">
                            <label for="filter__main-standard">Standard</label>
                        </div>
                        <div class="filter__main-box">
                            <input type="checkbox" name="filter__main-deluxe" id="filter__main-deluxe">
                            <label for="filter__main-deluxe">Deluxe</label>
                        </div>
                        <div class="filter__main-box">
                            <input type="checkbox" name="filter__main-supervisor" id="filter__main-supervisor">
                            <label for="filter__main-supervisor">Supervisor</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-8"></div>
        </div>
    </div>

    <footer class="app__footer">
        <div style="max-width: 1200px;margin: 0 auto;">
            <div class="app__footer-contact">
                <h3 class="app__footer-contact-title">
                    Enter your e-mail address and get<br> notified of exclusive offers
                </h3>

                <div class="app__footer-contact-input">
                    <div class="app__footer-input">
                        <input type="text" placeholder="Your e-mail address">
                    </div>

                    <div class="app__footer-btn">
                        <a href="Index" class="app__search-btn btn-footer">Get Started</a>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col l-2-4 m-2-4 c-4">
                    <a href="#" class="app__nav-name-link">
                        <img src="../assets/img/logo.png" alt="Logo" class="app__nav-name-icon">
                    </a>
                </div>
                <div class="col l-2-4 m-2-4 c-4">
                    <ul class="app__footer-list">
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">About us</a>
                        </li>
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Newsletter</a>
                        </li>
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Careers</a>
                        </li>
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Blog</a>
                        </li>
                    </ul>
                </div>
                <div class="col l-2-4 m-2-4 c-4">
                    <ul class="app__footer-list">
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Community</a>
                        </li>
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Trivia Community</a>
                        </li>
                    </ul>
                </div>
                <div class="col l-2-4 m-2-4 c-4 mobile-offset-4">
                    <ul class="app__footer-list">
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Support</a>
                        </li>
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Help Centre</a>
                        </li>
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Safety Information</a>
                        </li>
                    </ul>
                </div>
                <div class="col l-2-4 m-2-4 c-4">
                    <ul class="app__footer-list">
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Hedge Karla</a>
                        </li>
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Mullein abc</a>
                        </li>
                        <li class="app__footer-list-item">
                            <a href="#" class="app__footer-list-item-link">Autumnal Bulgier</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="app__footer-socials">
                <ul class="app__footer-socials-list">
                    <li class="app__footer-socials-item">
                        <a href="#" class="app__footer-socials-item-link">
                            <i class="app__footer-socials-item-icon fa-brands fa-square-instagram"></i>
                        </a>
                    </li>
                    <li class="app__footer-socials-item">
                        <a href="#" class="app__footer-socials-item-link">
                            <i class="app__footer-socials-item-icon fa-brands fa-twitter"></i>
                        </a>
                    </li>
                    <li class="app__footer-socials-item">
                        <a href="#" class="app__footer-socials-item-link">
                            <i class="app__footer-socials-item-icon fa-brands fa-youtube"></i>
                        </a>
                    </li>
                    <li class="app__footer-socials-item">
                        <a href="#" class="app__footer-socials-item-link">
                            <i class="app__footer-socials-item-icon fa-brands fa-square-facebook"></i>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="app__footer-copyright">
                Copyright &copy; 2022 Alien
            </div>
        </div>
    </footer>

    <script src="~/Scripts/custom/Homepage.js"></script>
    <script>
        function seeMore() {
            let actionSeeActive = document.querySelector('.action-see-active');
            let actionSeeUnactive = document.querySelector('.action-see-unactive');

            actionSeeActive.addEventListener('click', () => {
                document.querySelector('.filter-see-more').style.display = 'block';
                actionSeeActive.classList.toggle('action-see-active');
                actionSeeActive.classList.toggle('action-see-unactive');
                actionSeeUnactive.classList.toggle('action-see-active');
                actionSeeUnactive.classList.toggle('action-see-unactive');
            });

            actionSeeUnactive.addEventListener('click', () => {
                document.querySelector('.filter-see-more').style.display = 'none';
                actionSeeActive.classList.toggle('action-see-active');
                actionSeeActive.classList.toggle('action-see-unactive');
                actionSeeUnactive.classList.toggle('action-see-active');
                actionSeeUnactive.classList.toggle('action-see-unactive');
            });
        }

        seeMore();
    </script>

    <script>
        $(document).ready(function () {
            var arraySearch = [
                $('input[name="search-destination"]').val(),
                $('#app__check-in').val(),
                $('#app__check-out').val(),
                $('#bed-num').val(),
            ];

            function showResultSearch(array, condition) {
                $.ajax({
                    type: "POST",
                    url: `/Homepage/${condition}`,
                    data: {
                        values: array
                    },
                    datatype: "json",
                    contentType: 'application/x-www-form-urlencoded',
                    success: function (data) {
                        let html = ``;

                        if (data.propertyID.length > 0) {
                            for (let i = 0; i < data.propertyID.length; i++) {
                                html += `
                                            <div class="result-item">
                                                <img src="${data.image[i]}" alt="${data.propertyID[i]}" class="result-item-img">
                                                <div class="result-item-info">
                                                    <div class="result-item-info-header">
                                                        <span class="result-item-info-name">${data.propertyName[i]}</span>
                                                        <span class="result-item-info-point">Point: ${data.point[i]}</span>
                                                    </div>
                                                    <div class="result-item-info-address"
                                                            style="height: 42px;
                                                            overflow: hidden;
                                                            display: -webkit-box;
                                                            -webkit-box-orient: vertical;
                                                            -webkit-line-clamp: 2;">
                                                        ${data.address[i]}
                                                        </div>
                                                    <div class="result-item-info-price"><span>${data.price[i]} VND</span></div>
                                                    <div class="result-item-info-desc">
                                                        <span class="result-item-info-type">${data.typeRoom[i]}</span>
                                                        <button type="button" style="
                                                                                    padding: 2px 4px;
                                                                                    border: none;
                                                                                    outline: none;
                                                                                    background-color: transparent;
                                                                                    color: #0093b6;">
                                                            See availability
                                                        </button>
                                                    </div>
                                                </div>
                                            </div> `;
                            };
                        } else {
                            html += `
                                        <div class="text-center">
                                            <p style="font-size: 28px;">
                                                <i class="fa-solid fa-magnifying-glass"></i>
                                            </p>
                                            <p style="font-size: 24px;font-weight: 700;">No properties found in ${$('input[name="search-destination"]').val()}</p>
                                            <p>There are no matching properties for your search criteria. Try updating your search</p>
                                            <button type="button" class="px-3 py-2 btn btn-primary">Update search</button>
                                        </div>`;
                        }

                        $('.col-8').html(html);
                    },
                    error: function () {
                        alert("Error occured!!!");
                    }
                });
            };

            function sortByPrice() {
                $('.box-sort-list .box-sort-list-item:first-child').click(function () {
                    showResultSearch(arraySearch, 'SortByAscending')
                });
                $('.box-sort-list .box-sort-list-item:nth-child(2)').click(function () {
                    showResultSearch(arraySearch, 'SortByDescending')
                });
            };

            //Trường hợp điền thông tin vào box search ở trang homepage
            if ($('input[type="text"]').attr('placeholder') === "SESSION") {
                showResultSearch(arraySearch, 'ShowResultSearch');
            };

            //Trường hợp ấn vào destination
            if ($('input[type="text"]').attr('placeholder') === "Search destinations, hotels") {
                showResultSearch([$('input[type="text"]').attr('value')], 'SearchByPlaceName');
            };

            sortByPrice();

            $('.app__search-btn').click(function () {
                arraySearch = [
                    $('input[name="search-destination"]').val(),
                    $('#app__check-in').val(),
                    $('#app__check-out').val(),
                    $('#bed-num').val(),
                ];

                showResultSearch(arraySearch, 'ShowResultSearch');
            });

            function seeAvailabilityHover() {
                $('.col-8').on('mouseover', 'button', function () {
                    $(this).css('color', 'blue')
                });

                $('.col-8').on('mouseleave', 'button', function () {
                    $(this).css('color', '#0093b6')
                });
            };

            seeAvailabilityHover();

            $('.col-8').on('click', 'button', function () {
                var valueSend = [
                    $(this).parent().parent().parent().find('img').attr('alt'),
                    $(this).parent().parent().find('div:first-child span:first-child').html(),
                    $('#app__check-in').val(),
                    $('#app__check-out').val(),
                    $('#bed-num').val(),
                    $('#per-num').val(),
                ];
                $.ajax({
                    type: "POST",
                    url: "/Homepage/SendSearchDetail",
                    data: {
                        values: valueSend
                    },
                    datatype: "json",
                    contentType: 'application/x-www-form-urlencoded',
                    success: function (data) {
                        /*console.log(data.values)*/
                        window.location.replace("https://localhost:44306/Homepage/Search_Detail");
                    },
                    error: function () {
                        alert("Error occured!!!");
                    }
                });
            });
        });
    </script>
</body>
</html>
